# 数据库
- 主机数据库，老了说很厉害
- 关系型数据库

## 传统方法

### 数据库与关系系统

#### 什么是数据库？
- 定义了数据库为“结构化和有组织的数据仓储”，并指出通过数据库管理系统 (DBMS) 可访问数据。

#### 什么是数据库关系系统？
- DBMS 被定义为“数据存储、编辑、抽取的使能方法集合”。
- 引入了 SQL (Structured Query Language) 作为标准语言，用于数据交互和操纵。
- 数据以表 (tables) 形式存储，可以同时访问多个表中的数据。

#### 传统方法的局限性
- 高昂的成本：传统关系数据库的维护、许可证和存储费用昂贵。
- 复杂的数据模型：传统企业关系数据库的复杂数据模型导致高云端成本。
- 解决方法：通过重新设计数据库系统，降低服务保证，简化数据模型，并采用更经济的方法。

### 解决方法与具体实现

#### 降低服务保证与简化数据模型
- 将传统 RDBMS 复杂数据模型替换为简单的模型。
- 将“Always Consistent”模型替换为“Eventually Consistent”以降低成本。

#### 具体实现
- **Amazon’s Dynamo：** 介绍了亚马逊的 Dynamo 实现。
- **Google’s BigTable：** 探讨了谷歌的 BigTable 实现。
- **Facebook’s Cassandra：** 分析了 Facebook 的 Cassandra 实现。

### 数据的演变

#### 数据模型的灵活性
- 数据不必完全符合关系模型，灵活性更大。
- 不同场景下，信息数据的约束可以有所不同。

#### 示例
- 通过购物篮、Wikipedia 搜索、Web 页面信息检索等例子展示了不同类型的数据需求。
- 强调了数据量的爆炸性增长。

### 今天的数据与挑战

- 数据世界变化快速，传统关系数据库的模型受到挑战。
- 数据不一定非得符合关系模型，各种信息数据有不同的约束和需求。
- 强调了数据量巨大、多样性、以及对灵活性的迫切需求。

#### 数据分析与现代数据处理

- **数据分析：** 数据分析是一种处理、清理和解释数据的过程，以便提取有用的信息、推断结论和支持决策。
- **流时数据处理：** 强调实时处理数据流，适用于快速增量的数据源，例如位置信息、传感器数据等。
- **科学和智能数据库：** 探讨数据库在科学研究和智能系统中的应用。

#### 今天的数据类型

- **结构化、半结构化、非结构化数据：**
  - 结构化：具有明确的数据格式和长度，可以按实体分组。
  - 半结构化：包含一些结构信息，但格式不一致，可能包含不同属性。
  - 非结构化：没有特定结构或序列，如Web页面、音视频数据。

#### 大数据特征与挑战

- **大数据的特点：**
  - 非结构化、异构、增长速度快、多样性。
  - 无法进行形式化建模，难以在标准数据库和数据仓库中涵盖。
  - 数据价值不仅因数据量大而重要，难以取得满意的性能。

#### 大数据的解决方法

- **Amazon’s Dynamo：**
  - 用于 Amazon’s EC2 Cloud Hosting Service，提供高回弹存储服务。
  - 使用简单的 Primary-key 数据模型，在低成本节点上存储大量数据。

- **Google’s BigTable：**
  - Google 的主要数据云平台，使用复杂的 column-family 数据模型，相对于传统 RMDBS 更为简单。

- **Facebook’s Cassandra：**
  - Facebook 的主要数据云服务平台，采用 Google’s BigTable 类型的数据模型，并具有分布式特性。

#### 总结

- 大数据的处理需要适应非结构化、异构、多样性的特点。
- 解决方法包括使用简单的数据模型、分布式存储服务以及面向不同需求的专用数据云平台。
- 传统数据库和数据仓库难以涵盖大数据的多样性，需要新的技术和方法来应对挑战。

## Key-Value 存储 (KVS)
云服务应用越来越复杂，存储设施越来越简单。
文件操作包括大小不一的文件，读、写、追加、移动、重命名、加锁等。
操作系统中，用户习惯了功能丰富的界面，但实际存储设备简单，如HDD只需读写小的数据块。
云服务中也存在类似情况，用户接口功能丰富，但实际存储服务类似于数据库的读写操作。
### 基本概念与操作 
- Key-Value存储（KVS）是管理可持久化状态的简单抽象，数据以键值对形式存在。
- 基本运算包括PUT(key, value)，GET(key)返回value，Delete(key)删除。
### KVS 举例
- 主内存的哈希表结构。
- 磁盘文件索引结构，如BerkeleyDB。
- 倒排表索引用于搜索引擎。
- 数据库管理系统中的多个KVS。
- 分布式哈希表，如Chord/Pastry。
### KVS 及并发
通过KVS支持Internet服务，通过一个中心服务器，Web/应用服务器完成

两个问题
- 来自于不同客户端的多个并发请求
- 来自网络的不同部分，有消息传递延迟
  - 需要时间把请求发送至服务器
  - 将按照接受的顺序请求服务

并发管理
- 并发管理涉及处理同时接收到的多个请求，包括GET、PUT、DELETE等。
- 并发控制中的保护单元粒度是多少？

多数系统在每个数据项上使用锁进行并发控制。
- 锁管理器负责处理锁的申请和释放，通常使用FIFO顺序。
- 常见的锁包括S/X锁等，用于授权请求者对数据的访问。
- 除了锁之外，还存在其他并发控制的替代方案。S/X锁，详细内容可参考CIS 455等资料。

涉及到对不同请求的同时处理和保护数据的一致性
### Key-multi-value 存储; 光标

- 如果一个键可以对应多个值，例如一个人可以有多个头像，就需要考虑如何在存储系统中处理。
- 两种选项：
  1. 多值映射为一个集合：使用PUT操作前先进行GET，然后添加值，最后再进行PUT。
  2. KVS直接保存一键多值：通过光标进行滑动，类似于Java的Iterator。

访问数据

- 如何查找一键对应的所有值？
- 使用光标的编程模式：
  
  ```java
  cursor = kvs.getFirstMatch(key);
  while (cursor != null) {
      value = cursor.getValue();
      cursor = kvs.getNextMatch(key, cursor);
  }
  ```

- KVS（键值存储）是管理持久化数据的抽象，接口通常包括PUT和GET操作，有时还包括DELETE。
- 可以有不同的变种版本，如允许一键多值的情况。
- 举例：分布式哈希表、管理数组等。
- 是深度可扩展的真实系统。

问题
- 从KVS的角度看，不同的键值是独立的，因此难以原子性地改变多个值。
- 有些应用可能需要使用更高级别的锁来实现并发控制。


## 云平台的 Key-Value 存储
### 托管大型数据集
例子：Amazon产品列表、eBay产品列表、Facebook页面等。
思路：将云端看作大硬盘的抽象，具备耐久性、可用性、零延时、最小带宽使用和并发更新时的隔离性

### 现实情况和妥协
- 云平台存在通信时间开销、网络带宽限制、硬件故障和软件漏洞等实际情况。
- 不需要满足所有目标，需要在各方妥协和平衡。
- 观察：
  - 只读（或多数读）数据更易实现，多副本可以解决并发问题。
  - “几个大的数据对象”对长延时更容忍。
  - 可以为大多数读操作和小读写操作的数据对象设计不同的系统。

### 专用的KVS系统

- 云端KVS系统在特定需求或场景下进行妥协，例如Amazon的技术方案：
  - Simple Storage Service (S3): 适用于大数据对象，变化频率低。
  - SimpleDB/DynamoDB: 适用于小数据对象，更新频率高，需要一致性。

### 总结
- 倾向于简单、干净的方式，主要包括PUT和GET操作。
- 实际约束需要妥协，理想情况和现实情况存在差距。
- 针对不同任务负载，设计专用的KVS系统，没有一刀切的方法。
- 不同情况需要不同的技术方法，需要各种妥协和平衡。